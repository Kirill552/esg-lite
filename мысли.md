# 🛠️ АУДИТ РЕПОЗИТОРИЯ **ESG‑Lite** и «дорожная карта» до первых платёжных клиентов (обновлено VII‑2025)

> Репо: <https://github.com/Kirill552/ESG‑Lite>  
> Фокус: **дешёвый MVP** на русском IaaS, минимальный DevOps, первый платёж от пилот‑клиента (Магнит или экспортёр под CBAM).  
> Формат — чек‑лист/пояснения для новичка. Отмечайте `[x]` по мере реализации.

---

## 0. Быстрый статус кода (07‑2025)

| Слой            | Есть в репо | Пробелы / риски |
|-----------------|-------------|-----------------|
| ♻ Отчёт 296‑ФЗ PDF/HTML  | ✅ шаблоны + тесты | — |
| 🌍 CBAM Q‑report | ✅ шаблон, токены  | Нет XSD‑валидации (риск отклонения) |
| 📨 Upload → S3 (YC) | ✅ lib/s3.ts, работает | Нет retry‑логики, TTL URL 1 ч |
| 🖥️ API + Next 15  | ✅ Dockerfile, docker‑compose.prod | health‑чек /metrics отсутствует |
| 📦 PostgreSQL (Сбер VM) | ✅ Prisma, схема | Бэкапы, WAL‑архив — вручную |
| 📝 Очередь (BullMQ) | ⚠ stub на Postgres LISTEN | Redis не подключён |
| 🔍 OCR (Tesseract) | ✅ ocr‑worker.ts | Нет fallback (pdf → ocrmypdf) |
| 💳 ЮKassa         | отключена (верно) | — |
| 🧮 Расчёт выбросов | β‑версия emission‑calculator.ts | Unit‑тесты 0 % |

---

## 1. MVP‑инфраструктура «минимум денег»

| Что | Где держим | Цена /мес | Почему |
|-----|------------|-----------|--------|
| API + Worker (Next + ocr‑worker) | **Cloud.ru free‑tier**: 1 vCPU 10 % 🔸 1 ГБ RAM 🔸 30 ГБ NVMe 🔸 1 VM | **0 ₽** (постоянно) :contentReference[oaicite:0]{index=0} | Бесплатная ВМ навсегда, хватает для 1 клиента. |
| БД Postgres 16 | **SberCloud VM** (уже есть, 4 ГБ RAM) | 0 ₽ (бонусы) | Отдельная ВМ → сон при простое недопустим. |
| Хранилище PDF | **Yandex Object Storage** (стандарт) | ≈ 1,2 ₽/ГБ | 1 отчёт ≈ 0,3 МБ. |
| Очередь (позже) | Self‑host Redis 6 на той же free‑VM (Docker) | 0 ₽ | Пока Postgres LISTEN → swap, потом switch. |
| Мониторинг | **Yandex Cloud Monitoring** + YC Alerting | 0 ₽* | HTTP‑пинг `/health`, CPU/RAM, Postgres, OCR‑queue | Slack / Telegram / email |


> 🔐 Секреты (**.env**) держим в *GitHub Actions Encrypted Secrets* 

---

## 2. «Быстрый путь» к первому платёжному клиенту (капсация выручки круглый год)

### 2.1 Где есть деньги в 2025‑м
| Сегмент | Боль | Как монетизировать |
|---------|------|--------------------|
| **Экспортёры в ЕС** (металл, удобрения, цемент) | Квартальный CBAM‑отчёт до 31/01, 30/04, 31/07, 31/10 :contentReference[oaicite:1]{index=1} | **Quarterly CBAM Add‑on**: 30 000 ₽/кв‑л + 5 ₽/т сверх 5 000 т |
| **Российские ≥ 50 k т** | Годовой отчёт 296‑ФЗ (1 июля) | **Lite Годовой** 40 000 ₽/год включает 1 000 т |
| **Tier‑2 поставщики** (< 50 k т) | Заказчики требуют Scope 3 | **Supplier Widget**:\* 5 000 ₽/мес за API‑плагин 1С |

\* Для MVP достаточно mock‑endpoint `/api/supplier/upload`.

### 2.2 Ценовая матрица (MVP)
| План | Цена | Входит | Платится |
|------|------|--------|----------|
| **Free** | 0 | 1 000 т / год ♦ PDF rus | Когда ≤ порог |
| **Lite Annual** | 40 000 ₽/год | 1 000 т + приоритет | 1 счёт (снижет churn) |
| **Credits** | 5 ₽/т | Pay‑as‑you‑go | Любой момент |
| **CBAM Add‑on** | 30 000 ₽/кв‑л | 1 Q‑отчёт, XML, XSD‑валидация | 4×/год |
| **Supplier Widget** | 5 000 ₽/мес | API, CSV импорт | Месяц |

### 2.3 Как не «упасть» в июне/июле
* **Порог бесплатного OCR** — 10 файлов/90 сек (вы уже сделали).  
* **Аврал‑сбор**: если загрузка после 15 июня → кредит × 2.  
* **Очередь**: пока `bullmq @bull-board` с DB‑adapter; при >300 job/ч — поднять Redis‑Docker.

---

## 3. Чек‑лист до запуска ⚙️

| # | Задача | Where | Дока / подсказка |
|---|--------|-------|------------------|
| [ ] 1. Деплой Next + worker на Cloud.ru free VM | `docker-compose.prod.yml` | Статья «Deploy Docker on Cloud.ru VM 2025» |
| [ ] 2. Nginx‑proxy (`/api` → 3000) + HTTPS (Let’s Encrypt) | same VM | `jwilder/nginx-proxy + letsencrypt‑companion` |
| [ ] 3. Cron‑job `npm run backup:db` → S3 (weekly) | GitHub Actions | `pg_dump` |
| [ ] 4. Включить `lighthouse-ci` (budget mobile ≥ 90) | `.github/workflows/ci.yml` | docs |
| [ ] 5. XSD‑валидатор для CBAM‑XML (xmllint) | `scripts/validate_cbam.sh` | EC CBAM Annex I XSD |
| [ ] 6. Email‑инвайт Магнит (шаблон из `/emails`) | Marketing | 3 млн т * 5₽ = 15 млн — обсудить **Enterprise cap** |
| [ ] 7. Landing «CBAM 2025 Ready» + форма заявки | `/marketing-landing` | Astro SPA → Netlify free |

---

## 4. Как «оживить» пассивные модули (Suppliers, Marketplace)

### Suppliers Widget (basic)
1. API `/api/supplier/upload` принимает CSV (ИНН, выбросы, дата).  
2. Генерирует PDF‑квитанцию «Спасибо, данные приняты».  
3. Показывает в профиле заказчика status OK.  
*Бизнес‑эффект*: крупная компания оплачивает подписку «за них».

### Marketplace («позже, но готовим»)
| Этап | MVP идея | Как не делать лишнюю работу |
|------|----------|-----------------------------|
| I    | Папка Google Sheet «Сертифицированные аудиторы» | manual, 10 партнеров |
| II   | `/experts` страница (Next static) + фильтр регион | pull‑из Git |
| III  | Комиссия 10 % — платёж‑линк ЮKassa (`receipt_email`) | не нужен escrow |

---

## 5. Когда CBAM‑клиенты «начинают платить»

* 2025: **отчёт по Q2** → подать до **31 июля**. Значит, с 1 августа будет «боль» у тех, кто пропустил 📆 :contentReference[oaicite:2]{index=2}  
* Отчёты Q3 / Q4 → **31 окт** / **31 янв 2026**.  
* **EU‑метод** обязателен с 1 янв 2025 — многие ищут сервис, чтобы пересчитать нестандартные метрики :contentReference[oaicite:3]{index=3}.  

**→ Таргет:** экспортеры удобрений / проката (500–50 000 т/кв) — они готовы платить 40–120 k ₽ за «сделайте за меня XML».

---

## 6. Кому сразу написать (минимум CAC)

| Канал | Почему | Скрипт |
|-------|--------|--------|
| **РСПМ** (Российский союз поставщиков металлопродукции) | 200+ металл‑экспортёров; CBAM‑pain. | Вебинар «CBAM Q2 2025 без боли» + free PDF. |
| **РОСХИМПРОМ** | Удобрения / аммиак — попадают в CBAM. | Email‑луп «квартальный отчёт €0 до 1000 т». |
| **Магнит** пилот | 3 млн т | Скидка 50 % за кейс‑стади. |

---

## 7. Деньги vs затраты (грубый расчёт)

* 5 платных Lite (40 k) = 200 k  
* 2 CBAM‑клиента x 120 k = 240 k  
* **Выручка 440 k ₽ / год** в MVP‑фазе.  

**Опекс:**  
* Cloud.ru VM 0 ₽ + IP 90 ₽  
* S3 10 ГБ = 12 ₽  
* Домен 200 ₽  
* **Итого < 400 ₽ / мес**.

💡 При двух CBAM‑клиентах уже покрываете год расходов × 50.

---

## 8. FAQ (коротко)

* **Почему не Yandex Functions?** — платный по запросам; VM free‑tier дешевле.  
* **Что делать, если очередь > 300 job/ч?** — Поднять Redis‑Docker (256 МБ) на той же ВМ (10 %).  
* **А если 15 млн ₽ счёт Магниту?** — Ввести «Enterprise cap»: 3 млн ₽ макс + SLA.  

---

### 📑 Что дальше

1. Выполнить чек‑лист (1‑я колонка).  
2. Отправить пилот‑письма (Magnit + ассоциации).  
3. Первая оплаченная подписка → подключаем Redis + autoscale.

Как появятся вопросы по конкретному пункту — пингуй, дам code‑патч или расчёт.
