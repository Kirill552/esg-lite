#!/bin/bash

# –¢–µ—Å—Ç API –º–µ—Ç—Ä–∏–∫ —á–µ—Ä–µ–∑ curl
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–Ω–∞—á–∞–ª–∞: npm run dev

echo "üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API –º–µ—Ç—Ä–∏–∫ —á–µ—Ä–µ–∑ curl"
echo ""

BASE_URL="http://localhost:3000"

# 1. –ë–∞–∑–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏
echo "üìä 1. –ü–æ–ª—É—á–µ–Ω–∏–µ –±–∞–∑–æ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫"
curl -s "$BASE_URL/api/queue/metrics" | jq '.' || echo "‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –±–∞–∑–æ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫"
echo ""

# 2. –ú–µ—Ç—Ä–∏–∫–∏ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
echo "üìà 2. –ú–µ—Ç—Ä–∏–∫–∏ –∑–∞ 12 —á–∞—Å–æ–≤ —Å –ª–∏–º–∏—Ç–æ–º 50"
curl -s "$BASE_URL/api/queue/metrics?period=12&limit=50" | jq '.data.period, .data.summary' || echo "‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –º–µ—Ç—Ä–∏–∫ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏"
echo ""

# 3. –ú–µ—Ç—Ä–∏–∫–∏ –ø–æ —Ç–∏–ø—É
echo "üîç 3. –ú–µ—Ç—Ä–∏–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏"
curl -s "$BASE_URL/api/queue/metrics?type=processing_time&limit=5" | jq '.data.type, .data.count' || echo "‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –º–µ—Ç—Ä–∏–∫ –ø–æ —Ç–∏–ø—É"
echo ""

# 4. –í–∞–ª–∏–¥–∞—Ü–∏—è - –Ω–µ–≤–µ—Ä–Ω—ã–π –ø–µ—Ä–∏–æ–¥
echo "‚ö†Ô∏è 4. –¢–µ—Å—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ - –Ω–µ–≤–µ—Ä–Ω—ã–π –ø–µ—Ä–∏–æ–¥"
curl -s "$BASE_URL/api/queue/metrics?period=200" | jq '.error' || echo "‚ùå –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–µ—Ä–∏–æ–¥–∞"
echo ""

# 5. –í–∞–ª–∏–¥–∞—Ü–∏—è - –Ω–µ–≤–µ—Ä–Ω—ã–π —Ç–∏–ø
echo "‚ö†Ô∏è 5. –¢–µ—Å—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ - –Ω–µ–≤–µ—Ä–Ω—ã–π —Ç–∏–ø"
curl -s "$BASE_URL/api/queue/metrics?type=invalid" | jq '.error' || echo "‚ùå –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ç–∏–ø–∞"
echo ""

# 6. –û—á–∏—Å—Ç–∫–∞ –º–µ—Ç—Ä–∏–∫
echo "üßπ 6. –û—á–∏—Å—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –º–µ—Ç—Ä–∏–∫"
curl -s -X POST "$BASE_URL/api/queue/metrics?action=cleanup" | jq '.message' || echo "‚ùå –û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –º–µ—Ç—Ä–∏–∫"
echo ""

echo "üéâ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ curl –∑–∞–≤–µ—Ä—à–µ–Ω–æ!"