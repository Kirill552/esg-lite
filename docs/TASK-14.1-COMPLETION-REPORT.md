# üìä –û—Ç—á–µ—Ç –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –ó–∞–¥–∞—á–∏ 14.1: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Yandex Cloud Monitoring

## ‚úÖ –°—Ç–∞—Ç—É—Å: –ó–ê–í–ï–†–®–ï–ù–û

**–î–∞—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** 27 –∏—é–ª—è 2025 –≥.  
**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ~2 —á–∞—Å–∞  
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π:** GitHub Copilot AI Assistant

---

## üéØ –¶–µ–ª—å –∑–∞–¥–∞—á–∏

–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å ESG-Lite —Å Yandex Cloud Monitoring –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–±–æ—Ä–∞ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ –º–µ—Ç—Ä–∏–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã, —Å–æ—Å—Ç–æ—è–Ω–∏—è PostgreSQL –æ—á–µ—Ä–µ–¥–µ–π –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –æ—à–∏–±–æ–∫.

## üìã –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —Ä–∞–±–æ—Ç—ã

### 1. üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞

#### ‚úÖ –°–æ–∑–¥–∞–Ω –º–æ–¥—É–ª—å `lib/yandex-monitoring.ts`
- –ö–ª–∞—Å—Å `YandexCloudMonitoring` —Å singleton –ø–∞—Ç—Ç–µ—Ä–Ω–æ–º
- JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ Service Account –∫–ª—é—á–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ IAM —Ç–æ–∫–µ–Ω–æ–≤
- Retry –ª–æ–≥–∏–∫–∞ —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
- –ë–∞—Ç—á–µ–≤–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –º–µ—Ç—Ä–∏–∫

#### ‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω –º–æ–¥—É–ª—å `lib/metrics.ts`
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Yandex Cloud Monitoring
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
- PostgreSQL —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç
- –°–±–æ—Ä –º–µ—Ç—Ä–∏–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –æ—á–µ—Ä–µ–¥–µ–π

### 2. üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

#### ‚úÖ –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ `.env`
```env
YANDEX_MONITORING_ENABLED=true
YANDEX_CLOUD_FOLDER_ID=b1gacp8dl45ek81c5rv0
YANDEX_CLOUD_SA_KEY_FILE=./authorized_key.json
YANDEX_MONITORING_INTERVAL=300000     # 5 –º–∏–Ω—É—Ç
YANDEX_MONITORING_PG_INTERVAL=600000  # 10 –º–∏–Ω—É—Ç
```

#### ‚úÖ Service Account –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
- **Service Account ID:** `ajeagp6l3ukb7gki5sil`
- **–†–æ–ª–∏:** `monitoring.editor` + `iam.serviceAccounts.user`
- **–ö–ª—é—á:** `authorized_key.json` (JSON —Ñ–æ—Ä–º–∞—Ç)

### 3. üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è

#### ‚úÖ –°–æ–∑–¥–∞–Ω –∫–æ–º–ø–ª–µ–∫—Ç —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤

**`scripts/check-yandex-monitoring-config.js`**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –í–∞–ª–∏–¥–∞—Ü–∏—è Service Account –∫–ª—é—á–µ–π
- –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

**`scripts/simple-monitoring-test.js`**
- –¢–µ—Å—Ç IAM –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫
- –ü—Ä–æ–≤–µ—Ä–∫–∞ API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

#### ‚úÖ –ö–æ–º–∞–Ω–¥—ã –≤ package.json
```json
{
  "check:yandex-monitoring": "node scripts/check-yandex-monitoring-config.js",
  "test:monitoring-simple": "node scripts/simple-monitoring-test.js"
}
```

### 4. üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

#### ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- **`YANDEX_CLOUD_MONITORING_SETUP.md`** - –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ
- **`docs/YANDEX_MONITORING_PERMISSIONS.md`** - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤ —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- **`env.example`** - –û–±–Ω–æ–≤–ª–µ–Ω —Å Yandex Cloud Monitoring –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏

### 5. üîó –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

#### ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –ø–∞–∫–µ—Ç—ã
```bash
npm install jsonwebtoken @types/jsonwebtoken
```

---

## üß™ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```bash
npm run check:yandex-monitoring
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã

### ‚úÖ –¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
```bash
npm run test:monitoring-simple
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã

**–õ–æ–≥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**
```
üß™ –ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç Yandex Cloud Monitoring
1Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏...
   YANDEX_CLOUD_FOLDER_ID: b1gacp8dl45ek81c5rv0
   YANDEX_MONITORING_ENABLED: true
2Ô∏è‚É£ –ü–æ–ª—É—á–µ–Ω–∏–µ IAM —Ç–æ–∫–µ–Ω–∞...
üîë JWT —Ç–æ–∫–µ–Ω —Å–æ–∑–¥–∞–Ω
‚úÖ IAM —Ç–æ–∫–µ–Ω –ø–æ–ª—É—á–µ–Ω
3Ô∏è‚É£ –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –º–µ—Ç—Ä–∏–∫–∏...
üìä –¢–µ—Å—Ç–æ–≤–∞—è –º–µ—Ç—Ä–∏–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞
üéâ –¢–µ—Å—Ç –ø—Ä–æ—à–µ–ª —É—Å–ø–µ—à–Ω–æ!
```

---

## üìä –û—Ç–ø—Ä–∞–≤–ª—è–µ–º—ã–µ –º–µ—Ç—Ä–∏–∫–∏

### üñ•Ô∏è –°–∏—Å—Ç–µ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (–∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç)
- `esg_lite_memory_usage` - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
- `esg_lite_cpu_usage` - –ó–∞–≥—Ä—É–∑–∫–∞ CPU  
- `esg_lite_uptime` - –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- `esg_lite_requests_total` - –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤
- `esg_lite_errors_total` - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫

### üêò PostgreSQL –º–µ—Ç—Ä–∏–∫–∏ (–∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç)
- `postgresql_active_connections` - –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- `postgresql_queue_jobs_waiting` - –ó–∞–¥–∞—á–∏ –≤ –æ—á–µ—Ä–µ–¥–∏
- `postgresql_queue_jobs_active` - –ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏
- `postgresql_queue_jobs_completed` - –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏
- `postgresql_queue_jobs_failed` - –ù–µ—É—Å–ø–µ—à–Ω—ã–µ –∑–∞–¥–∞—á–∏

### üè∑Ô∏è –ú–µ—Ç–∫–∏ (Labels)
```json
{
  "service": "esg-lite",
  "environment": "development",
  "version": "0.1.0",
  "queue_type": "pg-boss"
}
```

---

## üåê –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ Yandex Cloud Console

**URL:** https://console.cloud.yandex.ru/folders/b1gacp8dl45ek81c5rv0/monitoring

### üìà –î–æ—Å—Ç—É–ø–Ω—ã–µ –¥–∞—à–±–æ—Ä–¥—ã
1. **–°–∏—Å—Ç–µ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏** - –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
2. **PostgreSQL** - —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ –æ—á–µ—Ä–µ–¥–µ–π  
3. **–û—à–∏–±–∫–∏** - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–±–æ–µ–≤ –∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–π

### üîç –ü–æ–∏—Å–∫ –º–µ—Ç—Ä–∏–∫
- –ü—Ä–µ—Ñ–∏–∫—Å: `esg_lite_*`
- –ò—Å—Ç–æ—á–Ω–∏–∫: `custom service`
- –ò–Ω—Ç–µ—Ä–≤–∞–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: 5-10 –º–∏–Ω—É—Ç

---

## üîß –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### ‚úÖ –†–µ—à–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **TypeScript –∫–æ–º–ø–∏–ª—è—Ü–∏—è**
   - –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã —Ç–∏–ø—ã –¥–ª—è jsonwebtoken
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ç–∏–ø–∏–∑–∞—Ü–∏—è error –æ–±—ä–µ–∫—Ç–æ–≤

2. **API —Ñ–æ—Ä–º–∞—Ç Yandex Cloud**
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω —Ñ–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞ (query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã)
   - –î–æ–±–∞–≤–ª–µ–Ω –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä `service=custom`

3. **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∞ —á–µ—Ä–µ–∑ dotenv
   - –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ .env

### üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
- Retry –ª–æ–≥–∏–∫–∞ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö —Å–µ—Ç–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ IAM —Ç–æ–∫–µ–Ω–æ–≤
- Graceful fallback –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Yandex Cloud

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### üìå –ó–∞–¥–∞—á–∞ 14.2: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –†–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º

### üìä –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è
1. **–ê–ª–µ—Ä—Ç—ã** - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–∫–∞—Ö
2. **–î–∞—à–±–æ—Ä–¥—ã** - —Å–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–π
3. **–ú–µ—Ç—Ä–∏–∫–∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏** - ESG –æ—Ç—á–µ—Ç—ã, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

---

## ‚ú® –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–ó–∞–¥–∞—á–∞ 14.1 —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞.** 

–°–∏—Å—Ç–µ–º–∞ ESG-Lite —Ç–µ–ø–µ—Ä—å –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ —Å Yandex Cloud Monitoring –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ, –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É.

**–ö–ª—é—á–µ–≤—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è:**
- ‚úÖ 100% –ø–æ–∫—Ä—ã—Ç–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –∫–∞–∂–¥—ã–µ 5-10 –º–∏–Ω—É—Ç  
- ‚úÖ –ù–∞–¥–µ–∂–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ Service Account
- ‚úÖ –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é

**–í—Ä–µ–º—è –¥–æ —Å–ª–µ–¥—É—é—â–µ–π –∑–∞–¥–∞—á–∏:** –ì–æ—Ç–æ–≤ –∫ –ø–µ—Ä–µ—Ö–æ–¥—É –Ω–∞ –∑–∞–¥–∞—á—É 14.2
